<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sense - Verbanwendung</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            line-height: 1.6;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        
        .container {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 20px;
        }
        
        header {
            text-align: center;
            margin-bottom: 10px; /* noch weiter verringert */
            border-bottom: 1px solid #eee;
            padding-bottom: 5px; /* noch weiter verringert */
        }
        
        header h1 {
            font-size: 20px; /* noch kleiner */
            margin-bottom: 3px; /* noch weiter verringert */
        }
        
        header p {
            font-size: 13px; /* verkleinert */
            margin: 3px 0; /* verringert */
        }
        
        .search-container {
            display: flex;
            gap: 10px;
            margin-bottom: 10px; /* verringert */
            align-items: center;
            flex-wrap: wrap;
        }
        
        .search-container input {
            flex: 1;
            padding: 6px; /* verringert */
            font-size: 14px; /* verkleinert */
            border: 1px solid #ddd;
            border-radius: 4px;
            min-width: 200px;
        }
        
        .search-container input:focus {
            border-color: #666;
            outline: none;
        }
        
        .search-hint {
            width: 100%;
            font-size: 12px; /* verkleinert */
            color: #666;
            margin-top: 3px; /* verringert */
        }
        
        button {
            background-color: #444; /* dunkelgrau statt blau */
            color: white;
            border: none;
            padding: 6px 10px; /* verringert */
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px; /* verkleinert */
        }
        
        button:hover {
            background-color: #666; /* helleres grau beim hover */
        }
        
        button:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }
        
        .navigation {
            display: flex;
            justify-content: space-between;
            margin-top: 10px; /* verringert */
        }
        
        .nav-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap; /* erlaubt Umbruch wenn nötig */
        }
        
        .position-info {
            background-color: #f0f0f0; /* heller, nicht farbig */
            padding: 4px 8px;
            border-radius: 4px;
            margin-left: auto;
            font-size: 13px; /* verkleinert */
        }
        
        .display-area {
            margin: 12px 0; /* verringert */
            padding: 12px; /* verringert */
            background-color: #f9f9f9;
            border-radius: 8px;
            border-left: 2px solid #ccc; /* grau statt blau */
        }
        
        .verb-heading {
            font-size: 20px; /* verkleinert */
            margin-bottom: 6px; /* verringert */
            color: black;
        }
        
        .verb-info {
            font-size: 14px; /* verkleinert */
            color: #666;
            margin-bottom: 10px; /* verringert */
        }
        
        .code-display {
            font-family: 'Courier New', monospace;
            background-color: #f0f0f0; /* heller, nicht farbig */
            padding: 10px; /* verringert */
            border-radius: 4px;
            margin-bottom: 10px; /* verringert */
        }
        
        .explanation {
            padding: 10px; /* verringert */
            background-color: #f0f0f0; /* heller, nicht farbig */
            border-radius: 4px;
            margin-bottom: 8px; /* verringert */
            font-size: 13px; /* kleinere Schrift */
        }
        
        .formula-additions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 8px;
            margin-bottom: 8px;
        }
        
        .formula-item {
            cursor: pointer;
            background-color: #f0f0f0;
            padding: 3px 6px;
            border-radius: 3px;
            border: 1px solid #ddd;
            font-size: 13px;
        }
        
        .formula-item:hover {
            background-color: #e0e0e0;
            border-color: #aaa;
        }
        
        .formula-item.active {
            background-color: #e0e0e0;
            border-color: #999;
            font-weight: bold;
        }
        
        .formula-explanation {
            margin-top: 5px;
            padding: 8px;
            background-color: #f5f5f5;
            border-radius: 4px;
            border-left: 2px solid #ccc;
            font-size: 13px;
            line-height: 1.4;
        }
        
        .complexity-info {
            margin-top: 5px;
            font-size: 13px; /* gleiche Größe wie Zeichenerklärungen */
            color: #333;
            background-color: #f5f5f5; /* gleicher Hintergrund wie Zeichenerklärungen */
            padding: 8px;
            border-radius: 4px;
            border-left: 2px solid #ccc; /* gleicher Border wie Zeichenerklärungen */
            line-height: 1.4;
        }
        
        .alternatives {
            margin-top: 12px; /* verringert */
            border-top: 1px dashed #ccc;
            padding-top: 10px; /* verringert */
        }
        
        .alternative-item {
            margin-bottom: 10px; /* verringert */
            padding: 6px; /* verringert */
            background-color: #f0f0f0;
            border-radius: 4px;
        }
        
        .suggestion {
            margin-top: 6px; /* verringert */
            padding: 6px; /* verringert */
            background-color: #f0f0f0; /* nicht farbig */
            border-radius: 4px;
            font-size: 13px; /* verkleinert */
        }
        
        .error-message {
            color: #d9534f;
            background-color: #f0f0f0; /* nicht farbig */
            padding: 6px; /* verringert */
            border-radius: 4px;
            margin: 6px 0; /* verringert */
            font-size: 13px; /* verkleinert */
            border-left: 2px solid #d9534f; /* roter Rand links */
        }
        
        .project-info {
            margin-top: 15px; /* verringert */
            padding: 10px; /* verringert */
            background-color: #f0f0f0;
            border-radius: 4px;
            font-size: 12px; /* verkleinert */
            text-align: center;
        }
        
        .loading-indicator {
            text-align: center;
            padding: 10px;
            font-style: italic;
            color: #666;
        }
        
        /* Responsives Design */
        @media (max-width: 768px) {
            .search-container {
                flex-direction: column;
                align-items: stretch;
            }
            
            .position-info {
                margin-left: 0;
                text-align: center;
                margin-top: 6px; /* verringert */
            }
        }
        
        /* Für kleinere Bildschirme, aber dafür sorgen, dass Buttons sichtbar bleiben */
        @media (max-width: 640px) {
            .nav-buttons {
                justify-content: center;
                width: 100%;
            }
            
            .nav-buttons button {
                padding: 5px 8px;
                font-size: 13px;
            }
        }
        
        /* Bei noch kleineren Bildschirmen 2x2 Button-Layout */
        @media (max-width: 480px) {
            .nav-buttons {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 5px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Sense - Verbanwendung</h1>
            <p>Durchsuchen Sie deutsche Verben und deren SENSE-Kodierungen</p>
        </header>
        
        <div class="search-container">
            <input type="text" id="searchInput" placeholder="Verb eingeben..." autocomplete="off">
            <button id="searchButton">Suchen</button>
            <div class="position-info" id="positionInfo">Eintrag 0 von 0</div>
            <div class="search-hint">Bitte geben Sie nur deutsche Verben ein (Wörter die auf -en, -eln oder -ern enden).</div>
        </div>
        
        <div id="errorMessage" class="error-message" style="display: none;"></div>
        <div id="suggestions" class="suggestion" style="display: none;"></div>
        <div id="loadingIndicator" class="loading-indicator" style="display: none;">Lädt Datei...</div>
        
        <div class="display-area" id="displayArea">
            <div class="verb-heading" id="currentVerb">Geben Sie ein Verb ein</div>
            <div class="verb-info" id="verbInfo">Verwenden Sie das Suchfeld um nach einem Verb zu suchen.</div>
            <div class="code-display" id="codeDisplay">Der Code wird hier angezeigt.</div>
            <div class="explanation" id="explanationDisplay">Die Begründung wird hier angezeigt.</div>
            
            <!-- Formelzusätze erscheinen nun unter der Erklärung -->
            <div class="formula-additions">
                <span class="formula-item active" data-symbol="//">//</span>
                <span class="formula-item" data-symbol="-">-</span>
                <span class="formula-item" data-symbol="ADJ">ADJ</span>
                <span class="formula-item" data-symbol="NO/">NO/</span>
                <span class="formula-item" data-symbol="NOT/">NOT/</span>
                <span class="formula-item" data-symbol="CP/">CP/</span>
                <span class="formula-item" data-symbol="ANTI/">ANTI/</span>
            </div>
            <div class="formula-explanation" id="formulaExplanation">
                // ist der Code-Wechsel von Goals des Akteurs zum Antagonisten oder bei vorausgehender (4) vom Antagonisten zum Akteur.
            </div>
            
            <div class="complexity-info" id="complexityInfo">
                Komplexe Funktionalitäten erkennt man an längeren Zahlen-Codes mit 4 - 7 Zahlen-Elementen.
            </div>
            
            <div class="alternatives" id="alternativesArea" style="display: none;"></div>
        </div>
        
        <div class="navigation">
            <div class="nav-buttons">
                <button id="firstButton" disabled>Erste Seite</button>
                <button id="prevButton" disabled>Zurück</button>
                <button id="nextButton" disabled>Weiter</button>
                <button id="lastButton" disabled>Letzte Seite</button>
            </div>
        </div>
        
        <div class="project-info">
            <p>Sense &copy; 2023 - Lokale Verbanwendung</p>
            <p>Diese Anwendung verwendet aufgeteilte Verbdateien (D_A.txt, D_B.txt, etc.)</p>
        </div>
    </div>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Variablen für die Verarbeitung
            let verbEntries = [];             // Verben in aktueller Datei
            let uniqueVerbs = [];             // Alphabetische Liste der Verben in aktueller Datei
            let currentIndex = 0;             // Index des aktuell angezeigten Verbs
            let searchTimeout;                // Timeout für die Sucheingabe
            let lastSearchTerm = '';          // Letzter Suchbegriff
            let currentFile = null;           // Aktuell geladene Datei
            let cachedFiles = {};             // Cache für bereits geladene Dateien
            let totalVerbCount = 8607;        // Geschätzte Gesamtzahl der Verben in allen Dateien
            let currentVerbGlobalIndex = 0;   // Globale Position des aktuellen Verbs (über alle Dateien)
            
            // Datei-Informationen
            const fileInfo = {
                'A': { count: 0, verbRange: [] },
                'B': { count: 0, verbRange: [] },
                'C': { count: 0, verbRange: [] },
                'D': { count: 0, verbRange: [] },
                'E': { count: 0, verbRange: [] },
                'F': { count: 0, verbRange: [] },
                'G': { count: 0, verbRange: [] },
                'H': { count: 0, verbRange: [] },
                'I': { count: 0, verbRange: [] },
                'J': { count: 0, verbRange: [] },
                'K': { count: 0, verbRange: [] },
                'L': { count: 0, verbRange: [] },
                'M': { count: 0, verbRange: [] },
                'N': { count: 0, verbRange: [] },
                'O': { count: 0, verbRange: [] },
                'P': { count: 0, verbRange: [] },
                'Q': { count: 0, verbRange: [] },
                'R': { count: 0, verbRange: [] },
                'S': { count: 0, verbRange: [] },
                'T': { count: 0, verbRange: [] },
                'U': { count: 0, verbRange: [] },
                'V': { count: 0, verbRange: [] },
                'W': { count: 0, verbRange: [] },
                'X': { count: 0, verbRange: [] },
                'Y': { count: 0, verbRange: [] },
                'Z': { count: 0, verbRange: [] },
                'Ä': { count: 0, verbRange: [] },
                'Ö': { count: 0, verbRange: [] },
                'Ü': { count: 0, verbRange: [] }
            };
            
            // DOM-Elemente
            const searchInput = document.getElementById('searchInput');
            const searchButton = document.getElementById('searchButton');
            const positionInfo = document.getElementById('positionInfo');
            const errorMessage = document.getElementById('errorMessage');
            const suggestions = document.getElementById('suggestions');
            const loadingIndicator = document.getElementById('loadingIndicator');
            const displayArea = document.getElementById('displayArea');
            const currentVerb = document.getElementById('currentVerb');
            const verbInfo = document.getElementById('verbInfo');
            const codeDisplay = document.getElementById('codeDisplay');
            const explanationDisplay = document.getElementById('explanationDisplay');
            const alternativesArea = document.getElementById('alternativesArea');
            const firstButton = document.getElementById('firstButton');
            const prevButton = document.getElementById('prevButton');
            const nextButton = document.getElementById('nextButton');
            const lastButton = document.getElementById('lastButton');
            const formulaExplanation = document.getElementById('formulaExplanation');
            
            // Erklärungen für die Zeichen
            const symbolExplanations = {
                "//": "// ist der Code-Wechsel von Goals des Akteurs zum Antagonisten oder bei vorausgehender (4) vom Antagonisten zum Akteur.",
                "-": "- kennzeichnet Goals die nicht zum Ziel führen oder führen sollen.",
                "ADJ": "ADJ kennzeichnet ein Verb das als Adjektiv verwendet wird (machen - machbar).",
                "NO/": "NO/ ist ein Prefix das bedeutet, dass das Goal nicht erreicht werden kann, weil etwas entscheidendes nicht vorhanden ist.",
                "NOT/": "NOT/ ist ein Prefix das bedeutet, dass das Goal nicht erreicht wird.",
                "CP/": "CP/ Change Position ist ein Prefix das bedeutet, dass der Code für einen Antagonisten steht, dem das passiert was ihm der Akteur mit diesem Code antut.",
                "ANTI/": "ANTI/ ist ein Prefix, dass das genauen Gegenteil des Code ausdrückt."
            };
            
            // Event-Listeners für Formel-Zusätze
            document.querySelectorAll('.formula-item').forEach(item => {
                item.addEventListener('click', function() {
                    // Entferne aktive Klasse von allen Items
                    document.querySelectorAll('.formula-item').forEach(i => {
                        i.classList.remove('active');
                    });
                    
                    // Füge aktive Klasse zum angeklickten Item hinzu
                    this.classList.add('active');
                    
                    // Zeige die passende Erklärung an
                    const symbol = this.getAttribute('data-symbol');
                    formulaExplanation.textContent = symbolExplanations[symbol] || "Keine Erklärung verfügbar";
                });
            });
            
            // Hilfsfunktion: Zeigt die globale Position des aktuellen Verbs an
            function updateGlobalPosition() {
                let globalIndex = 0;
                
                // Zähle Verben in allen Dateien vor dem aktuellen Buchstaben
                if (currentFile) {
                    const letterIndex = Object.keys(fileInfo).indexOf(currentFile);
                    for (let i = 0; i < letterIndex; i++) {
                        const letter = Object.keys(fileInfo)[i];
                        globalIndex += fileInfo[letter].count;
                    }
                    
                    // Füge die Position in der aktuellen Datei hinzu
                    if (verbEntries.length > 0 && currentIndex >= 0) {
                        const entry = verbEntries[currentIndex];
                        const verbIndexInCurrentFile = uniqueVerbs.indexOf(entry.verb);
                        
                        // Addiere alle früheren Bedeutungen dieses Verbs
                        globalIndex += verbIndexInCurrentFile;
                        
                        // Addiere die aktuelle Bedeutungsnummer
                        globalIndex += entry.meaningNumber - 1;
                    }
                }
                
                currentVerbGlobalIndex = globalIndex + 1; // 1-basierte Indexierung
                
                // Aktualisiere die Anzeige
                positionInfo.textContent = `Verb ${currentVerbGlobalIndex} von ${totalVerbCount}`;
            }
            
            // Hilfsfunktion: Ermittle den Dateinamen basierend auf dem Buchstaben
            function getFileNameForLetter(letter) {
                if (!letter) return null;
                return `D_${letter.toUpperCase()}.txt`;
            }
            
            // Hilfsfunktion: Lade eine Datei basierend auf dem Anfangsbuchstaben
            async function loadFileForLetter(letter) {
                if (!letter) return null;
                
                // Normalisiere den Buchstaben
                letter = letter.toUpperCase();
                
                // Prüfe den Cache
                if (cachedFiles[letter]) {
                    console.log(`Verwende gecachte Datei für "${letter}"`);
                    return cachedFiles[letter];
                }
                
                const fileName = getFileNameForLetter(letter);
                console.log(`Lade Datei "${fileName}" für Buchstaben "${letter}"...`);
                
                // Zeige Ladeindikator
                loadingIndicator.style.display = 'block';
                
                try {
                    const response = await fetch(fileName);
                    
                    if (!response.ok) {
                        throw new Error(`Datei ${fileName} konnte nicht geladen werden (${response.status})`);
                    }
                    
                    const text = await response.text();
                    
                    // Speichere im Cache
                    cachedFiles[letter] = text;
                    currentFile = letter;
                    
                    console.log(`Datei "${fileName}" erfolgreich geladen.`);
                    return text;
                } catch (error) {
                    console.error(`Fehler beim Laden der Datei "${fileName}":`, error);
                    throw error;
                } finally {
                    // Verstecke Ladeindikator
                    loadingIndicator.style.display = 'none';
                }
            }
            
            // Lade eine Datei und verarbeite sie
            async function loadAndProcessFile(letter) {
                try {
                    // Lade die Datei
                    const text = await loadFileForLetter(letter);
                    
                    // Verarbeite die Daten
                    processVerbFile(text);
                    
                    return true;
                } catch (error) {
                    showError(`Fehler beim Laden der Datei für "${letter}": ${error.message}`);
                    return false;
                }
            }
            
            // Verarbeite die Verbdatei und strukturiere die Daten
            function processVerbFile(text) {
                console.log("Verarbeite Datei...");
                
                // Zurücksetzen der aktuellen Daten
                verbEntries = [];
                uniqueVerbs = [];
                
                // Teile den Text in Blöcke auf (Leerzeilen als Trenner)
                const blocks = text.split(/\n\s*\n/);
                console.log(`Gefundene Textblöcke: ${blocks.length}`);
                
                // Speichere die Anzahl der Verben für die aktuelle Datei
                if (currentFile) {
                    fileInfo[currentFile].count = blocks.length;
                }
                
                // Temporäres Array für die Einträge
                let tempEntries = [];
                
                // Verarbeite jeden Block (ein Block = ein Eintrag mit Begründung)
                for (let blockIndex = 0; blockIndex < blocks.length; blockIndex++) {
                    const block = blocks[blockIndex].trim();
                    if (!block) continue; // Leere Blöcke überspringen
                    
                    const lines = block.split('\n');
                    
                    // Finde die Verb-Zeile (sollte die erste sein)
                    let verbLine = null;
                    let explanationLine = null;
                    
                    for (let i = 0; i < lines.length; i++) {
                        const line = lines[i].trim();
                        if (!line) continue;
                        
                        if (line.startsWith('Begründung:')) {
                            explanationLine = line;
                        } else if (line.includes(':')) {
                            verbLine = line;
                        }
                    }
                    
                    if (verbLine) {
                        const colonPos = verbLine.indexOf(':');
                        const verb = verbLine.substring(0, colonPos).trim();
                        const code = verbLine.substring(colonPos + 1).trim();
                        
                        // Extrahiere die Begründung, falls vorhanden
                        let explanation = "";
                        if (explanationLine) {
                            explanation = explanationLine.substring('Begründung:'.length).trim();
                        }
                        
                        // Füge den Eintrag hinzu
                        tempEntries.push({
                            verb: verb,
                            code: code,
                            explanation: explanation,
                            blockIndex: blockIndex // Für die Sortierung
                        });
                    }
                }
                
                // Gruppiere nach Verb und nummeriere
                const verbGroups = {};
                tempEntries.forEach(entry => {
                    if (!verbGroups[entry.verb]) {
                        verbGroups[entry.verb] = [];
                    }
                    verbGroups[entry.verb].push(entry);
                });
                
                // Erstelle die finale Liste mit Bedeutungsnummern
                uniqueVerbs = Object.keys(verbGroups).sort();
                
                uniqueVerbs.forEach((verb, verbIndex) => {
                    // Sortiere nach der ursprünglichen Reihenfolge im Text
                    const sortedEntries = verbGroups[verb].sort((a, b) => a.blockIndex - b.blockIndex);
                    
                    // Füge Bedeutungsnummern hinzu
                    sortedEntries.forEach((entry, index) => {
                        verbEntries.push({
                            verb: entry.verb,
                            code: entry.code,
                            explanation: entry.explanation,
                            meaningNumber: index + 1,
                            totalMeanings: sortedEntries.length,
                            verbIndex: verbIndex + 1 // 1-basierter Index des Verbs in der alphabetischen Liste
                        });
                    });
                });
                
                console.log("Verarbeitung abgeschlossen");
                console.log(`Gefundene Einträge: ${verbEntries.length}`);
                console.log(`Einzigartige Verben: ${uniqueVerbs.length}`);
                
                // Aktualisiere die Positionsanzeige
                if (verbEntries.length > 0) {
                    displayEntry(0);
                }
                
                updateNavButtons();
            }
            
            // Zeige einen Eintrag an
            function displayEntry(index) {
                if (index < 0 || index >= verbEntries.length) {
                    showError('Ungültiger Index: ' + index);
                    return;
                }
                
                const entry = verbEntries[index];
                currentIndex = index;
                
                // Verb anzeigen
                currentVerb.textContent = entry.verb;
                currentVerb.style.color = 'black'; // Schwarz statt Blau
                
                // Zusätzliche Informationen anzeigen (lokale Nummerierung in der aktuellen Datei)
                verbInfo.textContent = `Verb ${entry.verbIndex} von ${uniqueVerbs.length} | ${entry.meaningNumber}. Bedeutung von ${entry.totalMeanings}`;
                
                // Aktualisiere die globale Position
                updateGlobalPosition();
                
                // Code anzeigen
                codeDisplay.textContent = entry.code;
                
                // Begründung anzeigen
                if (entry.explanation && entry.explanation.trim()) {
                    explanationDisplay.textContent = entry.explanation;
                    explanationDisplay.style.display = 'block';
                } else {
                    explanationDisplay.textContent = "Keine Begründung verfügbar";
                    explanationDisplay.style.display = 'block';
                }
                
                // Keine Alternativen mehr anzeigen, da jede Bedeutung einzeln dargestellt wird
                alternativesArea.style.display = 'none';
                
                // Fehler und Vorschläge zurücksetzen
                hideError();
                hideSuggestions();
                
                // Scrolle nach oben
                window.scrollTo(0, 0);
            }
            
            // Suche nach einem Verb mit dynamischem Laden der passenden Datei
            async function searchVerbWithFileLoading(term) {
                if (!term) {
                    hideSuggestions();
                    return false;
                }
                
                term = term.toLowerCase().trim();
                const firstLetter = term.charAt(0).toUpperCase();
                
                // Prüfe, ob wir die richtige Datei bereits geladen haben
                if (currentFile !== firstLetter) {
                    try {
                        const success = await loadAndProcessFile(firstLetter);
                        if (!success) {
                            showError(`Konnte keine Verben mit dem Anfangsbuchstaben "${firstLetter}" laden.`);
                            return false;
                        }
                    } catch (error) {
                        showError(`Fehler beim Laden der Datei: ${error.message}`);
                        return false;
                    }
                }
                
                // Jetzt können wir in den geladenen Einträgen suchen
                return searchVerb(term);
            }
            
            // Suche nach einem Verb innerhalb der aktuell geladenen Daten
            function searchVerb(term) {
                if (!term) {
                    hideSuggestions();
                    return false;
                }
                
                term = term.toLowerCase().trim();
                
                // Exakte Übereinstimmung suchen (erste Bedeutung)
                const exactMatch = verbEntries.findIndex(entry => 
                    entry.verb.toLowerCase() === term && entry.meaningNumber === 1
                );
                
                if (exactMatch !== -1) {
                    displayEntry(exactMatch);
                    hideError();
                    hideSuggestions();
                    return true;
                }
                
                // Suche nach Verben, die mit dem Suchbegriff beginnen (erste Bedeutung)
                const startsWith = verbEntries.findIndex(entry => 
                    entry.verb.toLowerCase().startsWith(term) && entry.meaningNumber === 1
                );
                
                if (startsWith !== -1) {
                    displayEntry(startsWith);
                    
                    // Zeige Vorschläge für ähnliche Verben
                    showSimilarVerbs(term);
                    return true;
                }
                
                // Teilübereinstimmung (erste Bedeutung)
                const partialMatch = verbEntries.findIndex(entry => 
                    entry.verb.toLowerCase().includes(term) && entry.meaningNumber === 1
                );
                
                if (partialMatch !== -1) {
                    displayEntry(partialMatch);
                    
                    // Zeige Vorschläge für ähnliche Verben
                    showSimilarVerbs(term);
                    return true;
                }
                
                // Wenn keine erste Bedeutung gefunden wurde, suche nach beliebiger Bedeutung
                const anyMatch = verbEntries.findIndex(entry => 
                    entry.verb.toLowerCase().includes(term)
                );
                
                if (anyMatch !== -1) {
                    displayEntry(anyMatch);
                    showSimilarVerbs(term);
                    return true;
                }
                
                // Keine Übereinstimmung gefunden
                showError(`Das Verb "${term}" wurde nicht gefunden. Möglicherweise ist es nicht in unserer Datenbank enthalten oder anders geschrieben.`);
                showSimilarVerbs(term);
                return false;
            }
            
            // Zeige ähnliche Verben als Vorschläge
            function showSimilarVerbs(term) {
                if (!term || term.length < 2) {
                    hideSuggestions();
                    return;
                }
                
                // Finde einzigartige Verben (keine Duplikate wegen mehrerer Bedeutungen)
                const similarVerbs = uniqueVerbs
                    .filter(verb => verb.toLowerCase().includes(term.toLowerCase()))
                    .slice(0, 5);  // Begrenze auf 5 Vorschläge
                
                if (similarVerbs.length > 0) {
                    suggestions.innerHTML = 'Ähnliche Verben: ' + 
                        similarVerbs.map(verb => `<a href="#" class="verb-suggestion">${verb}</a>`).join(', ');
                    suggestions.style.display = 'block';
                    
                    // Event-Listener für Vorschläge
                    document.querySelectorAll('.verb-suggestion').forEach(link => {
                        link.addEventListener('click', function(e) {
                            e.preventDefault();
                            const selectedVerb = this.textContent;
                            searchInput.value = selectedVerb;
                            searchVerbWithFileLoading(selectedVerb);
                        });
                    });
                } else {
                    hideSuggestions();
                }
            }
            
            // Prüfe, ob ein String ein gültiges deutsches Verb ist
            function isValidGermanVerb(text) {
                // Vereinfachte Prüfung: ein deutsches Verb endet typischerweise auf -en, -eln, -ern
                // und enthält keine Zahlen oder Sonderzeichen (außer ä, ö, ü, ß)
                const germanVerbPattern = /^[a-zäöüß]+(?:en|eln|ern)$/i;
                
                return germanVerbPattern.test(text.trim());
            }
            
            // Fehler anzeigen
            function showError(message) {
                errorMessage.textContent = message;
                errorMessage.style.display = 'block';
            }
            
            // Fehler ausblenden
            function hideError() {
                errorMessage.style.display = 'none';
            }
            
            // Vorschläge ausblenden
            function hideSuggestions() {
                suggestions.style.display = 'none';
            }
            
            // Navigationsbuttons aktualisieren
            function updateNavButtons() {
                prevButton.disabled = currentIndex <= 0 || verbEntries.length === 0;
                firstButton.disabled = currentIndex <= 0 || verbEntries.length === 0;
                nextButton.disabled = currentIndex >= verbEntries.length - 1 || verbEntries.length === 0;
                lastButton.disabled = currentIndex >= verbEntries.length - 1 || verbEntries.length === 0;
            }
            
            // Event-Listener registrieren
            
            // Live-Suche mit Timeout
            searchInput.addEventListener('input', function() {
                const term = this.value.trim();
                
                // Ignoriere kurze Eingaben für die Live-Suche
                if (term.length < 2) {
                    hideSuggestions();
                    return;
                }
                
                // Setze früheren Timeout zurück
                clearTimeout(searchTimeout);
                
                // Warte kurz, bevor die Suche durchgeführt wird
                searchTimeout = setTimeout(() => {
                    if (term !== lastSearchTerm) {
                        searchVerbWithFileLoading(term);
                        lastSearchTerm = term;
                    }
                }, 300);
            });
            
            // Such-Button
            searchButton.addEventListener('click', function() {
                const term = searchInput.value.trim();
                
                if (!term) {
                    showError('Bitte geben Sie ein Verb ein.');
                    return;
                }
                
                if (!isValidGermanVerb(term) && term.length > 2) {
                    showError('Bitte geben Sie ein gültiges deutsches Verb ein (endet typischerweise auf -en, -eln oder -ern).');
                    return;
                }
                
                searchVerbWithFileLoading(term);
            });
            
            // Navigationstasten
            prevButton.addEventListener('click', function() {
                if (currentIndex > 0) {
                    displayEntry(currentIndex - 1);
                    updateNavButtons();
                }
            });
            
            nextButton.addEventListener('click', function() {
                if (currentIndex < verbEntries.length - 1) {
                    displayEntry(currentIndex + 1);
                    updateNavButtons();
                }
            });
            
            firstButton.addEventListener('click', function() {
                if (verbEntries.length > 0) {
                    displayEntry(0);
                    updateNavButtons();
                }
            });
            
            lastButton.addEventListener('click', function() {
                if (verbEntries.length > 0) {
                    displayEntry(verbEntries.length - 1);
                    updateNavButtons();
                }
            });
            
            // Tastatur-Navigation
            document.addEventListener('keydown', function(e) {
                if (e.target === searchInput) {
                    // Wenn im Suchfeld, nur bei Enter-Taste suchen
                    if (e.key === 'Enter') {
                        const term = searchInput.value.trim();
                        if (term) {
                            searchVerbWithFileLoading(term);
                        }
                    }
                    return;
                }
                
                // Sonst allgemeine Navigation
                switch (e.key) {
                    case 'ArrowLeft':
                        if (currentIndex > 0) {
                            displayEntry(currentIndex - 1);
                            updateNavButtons();
                        }
                        break;
                    case 'ArrowRight':
                        if (currentIndex < verbEntries.length - 1) {
                            displayEntry(currentIndex + 1);
                            updateNavButtons();
                        }
                        break;
                    case 'Home':
                        if (verbEntries.length > 0) {
                            displayEntry(0);
                            updateNavButtons();
                        }
                        break;
                    case 'End':
                        if (verbEntries.length > 0) {
                            displayEntry(verbEntries.length - 1);
                            updateNavButtons();
                        }
                        break;
                }
            });
        });
    </script>
</body>
</html>