<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sense - Verbanwendung</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            line-height: 1.6;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        
        .container {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 20px;
        }
        
        header {
            text-align: center;
            margin-bottom: 10px;
            border-bottom: 1px solid #eee;
            padding-bottom: 5px;
        }
        
        header h1 {
            font-size: 20px;
            margin-bottom: 3px;
        }
        
        header p {
            font-size: 13px;
            margin: 3px 0;
        }
        
        .search-container {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .search-container input {
            flex: 1;
            padding: 6px;
            font-size: 14px;
            border: 1px solid #ddd;
            border-radius: 4px;
            min-width: 200px;
        }
        
        .search-container input:focus {
            border-color: #666;
            outline: none;
        }
        
        .search-hint {
            width: 100%;
            font-size: 12px;
            color: #666;
            margin-top: 3px;
        }
        
        button {
            background-color: #444;
            color: white;
            border: none;
            padding: 6px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        
        button:hover {
            background-color: #666;
        }
        
        button:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }
        
        .navigation {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
        }
        
        .nav-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .display-area {
            margin: 12px 0;
            padding: 12px;
            background-color: #f9f9f9;
            border-radius: 8px;
            border-left: 2px solid #ccc;
        }
        
        .verb-heading {
            font-size: 20px;
            margin-bottom: 6px;
            color: black;
        }
        
        .code-display {
            font-family: 'Courier New', monospace;
            background-color: #f0f0f0;
            padding: 10px;
            border-radius: 4px;
            margin-bottom: 10px;
        }
        
        .explanation {
            padding: 10px;
            background-color: #f0f0f0;
            border-radius: 4px;
            margin-bottom: 8px;
            font-size: 13px;
            min-height: 105px; /* 5 Zeilen */
        }
        
        .formula-additions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 8px;
            margin-bottom: 8px;
        }
        
        .formula-item {
            cursor: pointer;
            background-color: #f0f0f0;
            padding: 3px 6px;
            border-radius: 3px;
            border: 1px solid #ddd;
            font-size: 13px;
        }
        
        .formula-item:hover {
            background-color: #e0e0e0;
            border-color: #aaa;
        }
        
        .formula-item.active {
            background-color: #e0e0e0;
            border-color: #999;
            font-weight: bold;
        }
        
        .formula-explanation {
            margin-top: 5px;
            padding: 8px;
            background-color: #f5f5f5;
            border-radius: 4px;
            border-left: 2px solid #ccc;
            font-size: 13px;
            line-height: 1.4;
            min-height: 40px; /* Stabiler Erklärungsblock */
        }
        
        .complexity-info {
            margin-top: 5px;
            font-size: 13px;
            color: #333;
            background-color: #f5f5f5;
            padding: 8px;
            border-radius: 4px;
            border-left: 2px solid #ccc;
            line-height: 1.4;
        }
        
        .alternatives {
            margin-top: 12px;
            border-top: 1px dashed #ccc;
            padding-top: 10px;
        }
        
        .alternative-item {
            margin-bottom: 10px;
            padding: 6px;
            background-color: #f0f0f0;
            border-radius: 4px;
        }
        
        .suggestion {
            margin-top: 6px;
            padding: 6px;
            background-color: #f0f0f0;
            border-radius: 4px;
            font-size: 13px;
        }
        
        .error-message {
            color: #d9534f;
            background-color: #f0f0f0;
            padding: 6px;
            border-radius: 4px;
            margin: 6px 0;
            font-size: 13px;
            border-left: 2px solid #d9534f;
        }
        
        .project-info {
            margin-top: 15px;
            padding: 10px;
            background-color: #f0f0f0;
            border-radius: 4px;
            font-size: 12px;
            text-align: center;
        }
        
        .loading-indicator {
            text-align: center;
            padding: 10px;
            font-style: italic;
            color: #666;
        }
        
        /* Responsives Design */
        @media (max-width: 768px) {
            .search-container {
                flex-direction: column;
                align-items: stretch;
            }
        }
        
        /* Für kleinere Bildschirme, aber dafür sorgen, dass Buttons sichtbar bleiben */
        @media (max-width: 640px) {
            .nav-buttons {
                justify-content: center;
                width: 100%;
            }
            
            .nav-buttons button {
                padding: 5px 8px;
                font-size: 13px;
            }
        }
        
        /* Bei noch kleineren Bildschirmen 2x2 Button-Layout */
        @media (max-width: 480px) {
            .nav-buttons {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 5px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Sense - Verbanwendung</h1>
            <p>Durchsuchen Sie 5000 deutsche Verben und deren SENSE-Kodierungen</p>
        </header>
        
        <div class="search-container">
            <input type="text" id="searchInput" placeholder="Verb eingeben..." autocomplete="off">
            <button id="searchButton">Suchen</button>
            <!-- Position-Info entfernt -->
            <div class="search-hint">Bitte geben Sie nur deutsche Verben ein (Wörter die auf -en, -eln oder -ern enden).</div>
        </div>
        
        <div id="errorMessage" class="error-message" style="display: none;"></div>
        <div id="suggestions" class="suggestion" style="display: none;"></div>
        <div id="loadingIndicator" class="loading-indicator" style="display: none;">Lädt Datei...</div>
        
        <div class="display-area" id="displayArea">
            <div class="verb-heading" id="currentVerb">Geben Sie ein Verb ein</div>
            <div class="code-display" id="codeDisplay">Der Code wird hier angezeigt.</div>
            <div class="explanation" id="explanationDisplay">Die Begründung wird hier angezeigt.</div>
            
            <!-- Formelzusätze erscheinen nun unter der Erklärung -->
            <div class="formula-additions">
                <span class="formula-item active" data-symbol="//">//</span>
                <span class="formula-item" data-symbol="-">-</span>
                <span class="formula-item" data-symbol="ADJ">ADJ</span>
                <span class="formula-item" data-symbol="NO/">NO/</span>
                <span class="formula-item" data-symbol="NOT/">NOT/</span>
                <span class="formula-item" data-symbol="CP/">CP/</span>
                <span class="formula-item" data-symbol="ANTI/">ANTI/</span>
            </div>
            <div class="formula-explanation" id="formulaExplanation">
                // ist der Code-Wechsel von Goals des Akteurs zum Antagonisten oder bei vorausgehender (4) vom Antagonisten zum Akteur.
            </div>
            
            <div class="complexity-info" id="complexityInfo">
                Komplexe Funktionalitäten erkennt man an längeren Zahlen-Codes mit 4 - 7 Zahlen-Elementen.
            </div>
            
            <div class="alternatives" id="alternativesArea" style="display: none;"></div>
        </div>
        
        <div class="navigation">
            <div class="nav-buttons">
                <button id="firstButton">Erste Seite</button>
                <button id="prevButton">Zurück</button>
                <button id="nextButton">Weiter</button>
                <button id="lastButton">Letzte Seite</button>
            </div>
        </div>
        
        <div class="project-info">
            <p>Sense 2025 - Lokale Verbanwendung</p>

        </div>
    </div>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Variablen für die Verarbeitung
            let verbEntries = [];             // Verben in aktueller Datei
            let uniqueVerbs = [];             // Alphabetische Liste der Verben in aktueller Datei
            let currentIndex = 0;             // Index des aktuell angezeigten Verbs
            let searchTimeout;                // Timeout für die Sucheingabe
            let lastSearchTerm = '';          // Letzter Suchbegriff
            let currentFile = null;           // Aktuell geladene Datei
            let cachedFiles = {};             // Cache für bereits geladene Dateien
            
            // Verfügbare Buchstaben für die Navigation
            const AVAILABLE_LETTERS = "ABCDEFGHIJKLMNOPQRSTUVWXYZ";
            
            // Zuordnung von Umlauten zu Grundbuchstaben für die Dateisuche
            const UMLAUT_MAP = {
                'Ä': 'A',
                'Ö': 'O',
                'Ü': 'U'
            };
            
            // Liste der Dateien, die tatsächlich existieren
            let availableFiles = {};
            
            // DOM-Elemente - wie im Original
            const searchInput = document.getElementById('searchInput');
            const searchButton = document.getElementById('searchButton');
            const errorMessage = document.getElementById('errorMessage');
            const suggestions = document.getElementById('suggestions');
            const loadingIndicator = document.getElementById('loadingIndicator');
            const displayArea = document.getElementById('displayArea');
            const currentVerb = document.getElementById('currentVerb');
            const codeDisplay = document.getElementById('codeDisplay');
            const explanationDisplay = document.getElementById('explanationDisplay');
            const alternativesArea = document.getElementById('alternativesArea');
            const firstButton = document.getElementById('firstButton');
            const prevButton = document.getElementById('prevButton');
            const nextButton = document.getElementById('nextButton');
            const lastButton = document.getElementById('lastButton');
            const formulaExplanation = document.getElementById('formulaExplanation');
            
            // Erklärungen für die Zeichen - unverändert
            const symbolExplanations = {
                "//": "// ist der Code-Wechsel von Goals des Akteurs zum Antagonisten oder bei vorausgehender (4) vom Antagonisten zum Akteur.",
                "-": "- kennzeichnet Goals die nicht zum Ziel führen oder führen sollen.",
                "ADJ": "ADJ kennzeichnet ein Verb das als Adjektiv verwendet wird (machen - machbar).",
                "NO/": "NO/ ist ein Prefix das bedeutet, dass das Goal nicht erreicht werden kann, weil etwas entscheidendes nicht vorhanden ist.",
                "NOT/": "NOT/ ist ein Prefix das bedeutet, dass das Goal nicht erreicht wird.",
                "CP/": "CP/ Change Position ist ein Prefix das bedeutet, dass der Code für einen Antagonisten steht, dem das passiert was ihm der Akteur mit diesem Code antut.",
                "ANTI/": "ANTI/ ist ein Prefix, dass das genauen Gegenteil des Code ausdrückt."
            };
            
            // Initialisiere das System - Prüfe welche Dateien verfügbar sind
            initSystem();
            
            async function initSystem() {
                // Prüfe, welche Dateien verfügbar sind
                for (let i = 0; i < AVAILABLE_LETTERS.length; i++) {
                    const letter = AVAILABLE_LETTERS[i];
                    const fileName = getFileNameForLetter(letter);
                    
                    try {
                        const response = await fetch(fileName, { method: 'HEAD' });
                        availableFiles[letter] = response.ok;
                        
                        if (response.ok && !currentFile) {
                            // Lade die erste verfügbare Datei
                            await loadAndProcessFile(letter);
                        }
                    } catch (error) {
                        availableFiles[letter] = false;
                        console.warn(`Datei ${fileName} nicht verfügbar.`);
                    }
                }
                
                // Wenn keine Datei geladen wurde, versuche 'A'
                if (!currentFile) {
                    try {
                        await loadAndProcessFile('A');
                    } catch (error) {
                        showError("Keine Verbdateien gefunden. Bitte geben Sie ein Verb ein, um zu starten.");
                    }
                }
                
                // Aktiviere die Buttons basierend auf verfügbaren Dateien
                updateNavButtons();
            }
            
            // Event-Listeners für Formel-Zusätze - unverändert
            document.querySelectorAll('.formula-item').forEach(item => {
                item.addEventListener('click', function() {
                    // Entferne aktive Klasse von allen Items
                    document.querySelectorAll('.formula-item').forEach(i => {
                        i.classList.remove('active');
                    });
                    
                    // Füge aktive Klasse zum angeklickten Item hinzu
                    this.classList.add('active');
                    
                    // Zeige die passende Erklärung an
                    const symbol = this.getAttribute('data-symbol');
                    formulaExplanation.textContent = symbolExplanations[symbol] || "Keine Erklärung verfügbar";
                });
            });
            
            // Hilfsfunktion: Ermittle den Dateinamen basierend auf dem Buchstaben
            function getFileNameForLetter(letter) {
                if (!letter) return null;
                // Einfache Dateinamen, keine Umlaute
                return `D_${letter}.txt`;
            }
            
            // Hilfsfunktion: Ermittle den Buchstaben für die Dateisuche (für Umlaute)
            function getFileLetter(letter) {
                if (!letter) return null;
                // Normalisiere zuerst auf Großbuchstaben
                letter = letter.toUpperCase();
                // Umlaute dem entsprechenden Grundbuchstaben zuordnen
                return UMLAUT_MAP[letter] || letter;
            }
            
            // Hilfsfunktion: Lade eine Datei basierend auf dem Anfangsbuchstaben
            async function loadFileForLetter(letter) {
                if (!letter) {
                    throw new Error("Kein Buchstabe angegeben");
                }
                
                // Konvertiere Umlaute für die Dateisuche
                const fileLetter = getFileLetter(letter);
                
                // Prüfe, ob der Buchstabe verfügbar ist
                if (availableFiles[fileLetter] === false) {
                    throw new Error(`Datei für Buchstaben "${letter}" ist nicht verfügbar.`);
                }
                
                // Prüfe den Cache (für den ursprünglichen Buchstaben)
                if (cachedFiles[letter]) {
                    console.log(`Verwende gecachte Datei für "${letter}"`);
                    return cachedFiles[letter];
                }
                
                const fileName = getFileNameForLetter(fileLetter);
                console.log(`Lade Datei "${fileName}" für Buchstaben "${letter}" (File-Buchstabe: ${fileLetter})...`);
                
                // Zeige Ladeindikator
                loadingIndicator.style.display = 'block';
                
                try {
                    const response = await fetch(fileName);
                    
                    if (!response.ok) {
                        availableFiles[fileLetter] = false;
                        throw new Error(`Datei ${fileName} konnte nicht geladen werden (${response.status})`);
                    }
                    
                    const text = await response.text();
                    
                    // Prüfe ob der Text nicht leer ist
                    if (!text.trim()) {
                        throw new Error(`Datei ${fileName} ist leer.`);
                    }
                    
                    // Speichere im Cache
                    cachedFiles[letter] = text;
                    currentFile = letter;
                    availableFiles[fileLetter] = true;
                    
                    console.log(`Datei "${fileName}" erfolgreich geladen.`);
                    return text;
                } catch (error) {
                    console.error(`Fehler beim Laden der Datei "${fileName}":`, error);
                    throw error;
                } finally {
                    // Verstecke Ladeindikator
                    loadingIndicator.style.display = 'none';
                }
            }
            
            // Lade eine Datei und verarbeite sie
            async function loadAndProcessFile(letter) {
                try {
                    // Konvertiere Umlaute
                    const fileLetter = getFileLetter(letter);
                    
                    // Prüfe, ob der Buchstabe gültig ist
                    if (!fileLetter || !AVAILABLE_LETTERS.includes(fileLetter)) {
                        console.error(`Ungültiger Buchstabe: ${letter} (File-Buchstabe: ${fileLetter})`);
                        return false;
                    }
                    
                    // Wenn wir bereits die richtige Datei geladen haben, nichts tun
                    if (currentFile === letter && verbEntries.length > 0) {
                        console.log(`Datei für '${letter}' ist bereits geladen.`);
                        return true;
                    }
                    
                    // Prüfe, ob die Datei verfügbar ist
                    if (availableFiles[fileLetter] === false) {
                        console.warn(`Datei für Buchstaben "${letter}" ist nicht verfügbar.`);
                        showError(`Datei für Buchstaben "${letter}" ist nicht verfügbar.`);
                        return false;
                    }
                    
                    console.log(`Lade Datei für Buchstaben '${letter}'...`);
                    
                    // Lade die Datei
                    const text = await loadFileForLetter(letter);
                    
                    // Verarbeite die Daten
                    processVerbFile(text);
                    
                    console.log(`Datei für '${letter}' erfolgreich geladen und verarbeitet.`);
                    
                    return verbEntries.length > 0;
                } catch (error) {
                    console.error(`Fehler beim Laden der Datei für "${letter}":`, error);
                    showError(`Fehler beim Laden der Datei für "${letter}": ${error.message}`);
                    return false;
                }
            }
            
            // Suche nach einem Verb mit dynamischem Laden der passenden Datei
            async function searchVerbWithFileLoading(term) {
                if (!term) {
                    hideSuggestions();
                    return false;
                }
                
                term = term.toLowerCase().trim();
                let firstLetter = term.charAt(0).toUpperCase();
                
                // Konvertiere den ersten Buchstaben für die Dateisuche
                const fileLetter = getFileLetter(firstLetter);
                
                // Prüfe, ob die entsprechende Datei verfügbar ist
                if (!AVAILABLE_LETTERS.includes(fileLetter)) {
                    showError(`Verben mit dem Anfangsbuchstaben "${firstLetter}" sind nicht verfügbar.`);
                    return false;
                }
                
                // Prüfe, ob wir die richtige Datei bereits geladen haben
                if (currentFile !== firstLetter) {
                    try {
                        // Lade die passende Datei für den Buchstaben
                        const success = await loadAndProcessFile(firstLetter);
                        
                        if (!success) {
                            // Wenn das Laden fehlschlägt, versuche es mit dem Grundbuchstaben
                            if (firstLetter !== fileLetter) {
                                const success2 = await loadAndProcessFile(fileLetter);
                                if (!success2) {
                                    showError(`Konnte keine Verben mit dem Anfangsbuchstaben "${firstLetter}" laden.`);
                                    return false;
                                }
                            } else {
                                showError(`Konnte keine Verben mit dem Anfangsbuchstaben "${firstLetter}" laden.`);
                                return false;
                            }
                        }
                    } catch (error) {
                        showError(`Fehler beim Laden der Datei: ${error.message}`);
                        return false;
                    }
                }
                
                // Jetzt können wir in den geladenen Einträgen suchen
                return searchVerb(term);
            }
            
            // Rest des Codes bleibt unverändert, da die obigen Änderungen die Probleme beheben sollten
            // ...
            
            // Navigation zum vorherigen Eintrag (auch über Dateigrenzen)
            async function goToPrevious() {
                // Speichern Sie den aktuellen Zustand vor der Navigation
                const previousFile = currentFile;
                const previousIndex = currentIndex;
                
                if (currentIndex > 0) {
                    // Zum vorherigen Eintrag in der aktuellen Datei wechseln
                    displayEntry(currentIndex - 1);
                } else {
                    // Suche nach dem vorherigen verfügbaren Buchstaben
                    const currentFileLetter = getFileLetter(currentFile);
                    const currentPos = AVAILABLE_LETTERS.indexOf(currentFileLetter);
                    let prevLetter = null;
                    
                    // Durchlaufe alle vorherigen Buchstaben (rückwärts)
                    for (let i = currentPos - 1; i >= 0; i--) {
                        const letter = AVAILABLE_LETTERS[i];
                        if (availableFiles[letter]) {
                            prevLetter = letter;
                            break;
                        }
                    }
                    
                    if (prevLetter) {
                        console.log(`Navigiere zu vorherigem Buchstaben: ${prevLetter}`);
                        try {
                            // Lade die vorherige Datei
                            const success = await loadAndProcessFile(prevLetter);
                            
                            if (success && verbEntries.length > 0) {
                                // Springe zum letzten Eintrag dieser Datei
                                displayEntry(verbEntries.length - 1);
                            } else {
                                // Bei Fehlern den vorherigen Zustand wiederherstellen
                                if (previousFile && previousIndex >= 0) {
                                    await loadAndProcessFile(previousFile);
                                    displayEntry(previousIndex);
                                }
                                showError(`Fehler beim Laden der Datei für '${prevLetter}'`);
                            }
                        } catch (error) {
                            console.error(`Fehler beim Laden der Datei ${prevLetter}:`, error);
                            // Bei Fehlern vorherigen Zustand wiederherstellen
                            if (previousFile && previousIndex >= 0) {
                                await loadAndProcessFile(previousFile);
                                displayEntry(previousIndex);
                            }
                            showError(`Fehler beim Laden der Datei für '${prevLetter}': ${error.message}`);
                        }
                    } else {
                        showError("Sie befinden sich bereits am Anfang der Datenbank.");
                    }
                }
            }
            
            // Navigation zum nächsten Eintrag (auch über Dateigrenzen)
            async function goToNext() {
                // Speichern Sie den aktuellen Zustand vor der Navigation
                const previousFile = currentFile;
                const previousIndex = currentIndex;
                
                if (currentIndex < verbEntries.length - 1) {
                    // Zum nächsten Eintrag in der aktuellen Datei wechseln
                    displayEntry(currentIndex + 1);
                } else {
                    // Suche nach dem nächsten verfügbaren Buchstaben
                    const currentFileLetter = getFileLetter(currentFile);
                    const currentPos = AVAILABLE_LETTERS.indexOf(currentFileLetter);
                    let nextLetter = null;
                    
                    // Durchlaufe alle folgenden Buchstaben
                    for (let i = currentPos + 1; i < AVAILABLE_LETTERS.length; i++) {
                        const letter = AVAILABLE_LETTERS[i];
                        if (availableFiles[letter]) {
                            nextLetter = letter;
                            break;
                        }
                    }
                    
                    if (nextLetter) {
                        console.log(`Navigiere zu nächstem Buchstaben: ${nextLetter}`);
                        try {
                            // Lade die nächste Datei
                            const success = await loadAndProcessFile(nextLetter);
                            
                            if (success && verbEntries.length > 0) {
                                // Springe zum ersten Eintrag dieser Datei
                                displayEntry(0);
                            } else {
                                // Bei Fehlern den vorherigen Zustand wiederherstellen
                                if (previousFile && previousIndex >= 0) {
                                    await loadAndProcessFile(previousFile);
                                    displayEntry(previousIndex);
                                }
                                showError(`Fehler beim Laden der Datei für '${nextLetter}'`);
                            }
                        } catch (error) {
                            console.error(`Fehler beim Laden der Datei ${nextLetter}:`, error);
                            // Bei Fehlern vorherigen Zustand wiederherstellen
                            if (previousFile && previousIndex >= 0) {
                                await loadAndProcessFile(previousFile);
                                displayEntry(previousIndex);
                            }
                            showError(`Fehler beim Laden der Datei für '${nextLetter}': ${error.message}`);
                        }
                    } else {
                        showError("Sie haben das Ende der Datenbank erreicht.");
                    }
                }
            }
            
            // Der Rest des Skripts bleibt unverändert
            // ...
        });
    </script>
</body>
</html>